<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Toditor">

	<select id="getCategory" resultType="www.tours2us.com.model.ToditorCategoryDto">
		select*from EDITORCATEGORY WHERE STATUS=1
	</select>

	<insert id="Toditorwrite" parameterType="www.tours2us.com.model.ToditorBBS">
	INSERT INTO EDITOR VALUES(EDITOR_SEQ.NEXTVAL, #{target_user_seq}, #{target_category_seq}, #{title}, #{content}, #{pic1}, sysdate, sysdate)
	</insert>
	
	<select id="ToditorgetList" resultType="www.tours2us.com.model.ToditorBBS">
	SELECT TITLE, E.SEQ, CONTENT, PIC1, (SELECT TITLE FROM EDITORCATEGORY WHERE SEQ = E.TARGET_CATEGORY_SEQ) AS CATEGORY, T.NAME
	FROM EDITOR E, TRAVELER T
	WHERE T.SEQ = E.TARGET_USER_SEQ
	ORDER BY E.REG_DATE DESC
	</select>
	
	<select id="ToditorgetPagingList" parameterType="www.tours2us.com.model.PagingVo" resultType="www.tours2us.com.model.ToditorBBS" >
	SELECT TITLE, SEQ, CONTENT, PIC1,CATEGORY, NAME
	FROM 
	( SELECT ROW_NUMBER() OVER (ORDER BY   E.REG_DATE DESC) as rnum,  
		TITLE, E.SEQ, CONTENT, PIC1, 
		(SELECT TITLE FROM EDITORCATEGORY WHERE SEQ = E.TARGET_CATEGORY_SEQ) AS CATEGORY, T.NAME
		FROM EDITOR E, TRAVELER T
		WHERE T.SEQ = E.TARGET_USER_SEQ 
		<if test="s_category != '' and s_category != null and s_keyword != '' and s_keyword != null">
			<if test="s_category == 'title'"> AND TITLE like '%'||#{s_keyword}||'%'</if>	
			<if test="s_category == 'contents'"> AND CONTENT like '%'||#{s_keyword}||'%'</if>	
		</if> 
		) A
		WHERE rnum between #{start} AND #{end}
	</select>

	
	<select id="ToditorgetBbsCount" parameterType="www.tours2us.com.model.PagingVo" resultType="java.lang.Integer">
	 
			SELECT NVL(count(*),0) AS cnt
			  FROM   EDITOR  WHERE 1 = 1
		
		<if test="s_category != '' and s_category != null and s_keyword != '' and s_keyword != null">
			<if test="s_category == 'title'"> AND TITLE like '%'||#{s_keyword}||'%'</if>	
			<if test="s_category == 'contents'"> AND CONTENT like '%'||#{s_keyword}||'%'</if>	
		</if>
	</select>	
	
	
	
	<select id="ToditorDetail" resultType="www.tours2us.com.model.ToditorBBS" parameterType="java.lang.Integer">
		SELECT E.SEQ, E.TITLE, E.CONTENT,  (SELECT TITLE FROM EDITORCATEGORY WHERE SEQ = E.TARGET_CATEGORY_SEQ) AS CATEGORY, T.NAME,  E.REG_DATE,
		T.PROFILE
		FROM EDITOR E, TRAVELER T
		WHERE T.SEQ = E.TARGET_USER_SEQ AND E.SEQ = #{seq}
	</select>
	
	<!-- 투둥이 가이드북 DISTINCT -->
	<!-- <select id="getUserPlanList" resultType="www.tours2us.com.model.PlanerDto">
		SELECT P.SEQ, P.TARGET_USER_SEQ, P.TITLE, P.LOCATION, P.STATUS, P.TO_DATE, P.FROM_DATE,
			P.RANGE, P.TOTAL_COST, P.REG_DATE, P.LAST_UPDATED, P.PAPER, T.NAME 
		FROM TRAVELER T, PLANER P 
		WHERE T.SEQ = P.TARGET_USER_SEQ AND P.STATUS NOT IN(SELECT STATUS FROM PLANER WHERE STATUS=2 OR STATUS=3 OR STATUS=4)
		ORDER BY REG_DATE DESC
	</select> -->
	
	<select id="guideSearch" parameterType="www.tours2us.com.model.PlanerDto" resultType="www.tours2us.com.model.PlanerDto">
		 SELECT  SEQ, TARGET_USER_SEQ, TITLE, LOCATION, STATUS, TO_DATE, FROM_DATE,
			RANGE, TOTAL_COST, REG_DATE, LAST_UPDATED, PAPER, NAME
		   FROM 
		   (SELECT ROW_NUMBER() OVER (ORDER BY P.REG_DATE DESC) as rnum,
		    P.SEQ, P.TARGET_USER_SEQ, P.TITLE, P.LOCATION, P.STATUS, P.TO_DATE, P.FROM_DATE,
			P.RANGE, P.TOTAL_COST, P.REG_DATE, P.LAST_UPDATED, P.PAPER, T.NAME 
            FROM TRAVELER T, PLANER P 
		   WHERE  T.SEQ = P.TARGET_USER_SEQ AND P.STATUS NOT IN(SELECT STATUS FROM PLANER WHERE STATUS=2 OR STATUS=3 OR STATUS=4)
		    <if test="s_category != '' and s_category != null and s_keyword != '' and s_keyword != null">
		      <if test="s_category == 'title'"> AND TITLE like '%'||#{s_keyword}||'%'</if>   
		      <if test="s_category == 'location'"> AND LOCATION like '%'||#{s_keyword}||'%'</if>
		   </if>
		   ) A
		   WHERE rnum between #{start} AND #{end} 
           ORDER BY REG_DATE DESC
	</select>
	
	<select id="guideCount"  parameterType="www.tours2us.com.model.PlanerDto" resultType="int">
   
	   SELECT NVL(COUNT(*),0) AS cnt
	   FROM PLANER WHERE 1 = 1
	   
	   <if test="s_category != '' and s_category != null and s_keyword != '' and s_keyword != null">
	      <if test="s_category == 'title'"> AND TITLE like '%'||#{s_keyword}||'%'</if>   
	      <if test="s_category == 'contents'"> AND CONTENT like '%'||#{s_keyword}||'%'</if>
	   </if>
	</select>  
	
</mapper>